<?xml version="1.0"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
    </PropertyGroup>

    <!-- Build patcher before building the contract -->
<!--    <Target Name="PatcherBuild" BeforeTargets="BeforeBuild">-->
<!--        <PropertyGroup>-->
<!--            <IsContract Condition="'@(ContractCode)' != ''">true</IsContract>-->
<!--            <IsSystemContract Condition="'@(ContractCode)' != '' And %(ContractCode.SystemContract) != '' And %(ContractCode.SystemContract)">true</IsSystemContract>-->
<!--        </PropertyGroup>-->
<!--        <MSBuild Condition="'$(IsContract)' != '' AND '$(IsContract)'" Projects="$(ProjectDir)/../../src/$(PatcherProjectName)/$(PatcherProjectName).csproj"/>-->
<!--    </Target>-->
  
    <!-- Patch the contract dll after building the contract -->
<!--    <Target Name="PatchContractCode" Condition="'$(IsContract)' != '' AND '$(IsContract)'" AfterTargets="AfterBuild">-->
<!--        <PropertyGroup>-->
<!--            <CmdPatchOverwrite></CmdPatchOverwrite>-->
<!--            <CmdPatchOverwrite Condition="'$(PatchOverwrite)' != '' AND '$(PatchOverwrite)'">-w</CmdPatchOverwrite>-->
<!--            <CmdSkipAudit></CmdSkipAudit>-->
<!--            <CmdSkipAudit Condition="'$(SkipAudit)' != '' AND '$(SkipAudit)'">-s</CmdSkipAudit>-->
<!--            <CmdTreatAsSystemContract></CmdTreatAsSystemContract>-->
<!--            <CmdTreatAsSystemContract Condition="'$(IsSystemContract)' != '' AND '$(IsSystemContract)'">-t</CmdTreatAsSystemContract>-->
<!--        </PropertyGroup>-->
<!--        <Exec WorkingDirectory="$(PatcherDir)"-->
<!--              Command="dotnet $(PatcherProjectName).dll $(CmdPatchOverwrite)$(CmdSkipAudit)$(CmdTreatAsSystemContract)-p $(TargetDir)$(TargetName).dll"-->
<!--              ConsoleToMSBuild="true">-->
<!--            <Output TaskParameter="ConsoleOutput" ItemName="PatchContractCodeOutput"/>-->
<!--        </Exec>-->
<!--        <Message Text="$(PatchContractCodeOutput)"/>-->
<!--    </Target>-->

    <PropertyGroup>
        <_ContractDetector_MsBuildAssembly Condition=" '$(_ContractDetector_MsBuildAssembly)' == '' and '$(MSBuildRuntimeType)' == 'Core'  ">..\lib\netstandard1.3\AElf.ContractDetector.dll</_ContractDetector_MsBuildAssembly>
        <_ContractDetector_MsBuildAssembly Condition=" '$(_ContractDetector_MsBuildAssembly)' == '' and '$(MSBuildRuntimeType)' != 'Core'  ">..\lib\net46\AElf.ContractDetector.dll</_ContractDetector_MsBuildAssembly>
    </PropertyGroup>
    
    <UsingTask AssemblyFile="$(_ContractDetector_MsBuildAssembly)" TaskName="AElf.Tools.ProtoToolsPatcher" />

    <Target Name="BuildPatcher" AfterTargets="AfterBuild">
        <ProtoToolsPatcher />
    </Target>

</Project>
