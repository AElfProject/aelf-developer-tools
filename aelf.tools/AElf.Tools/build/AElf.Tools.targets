<?xml version="1.0"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
        <ProjectRootPath>$(ProjectDir)../</ProjectRootPath>
        <ObjSrcPath>$(ProjectRootPath)src/obj/$(Configuration)/$(TargetFramework)/</ObjSrcPath>
        <ObjTestPath>$(ProjectRootPath)test/obj/$(Configuration)/$(TargetFramework)/</ObjTestPath>
    </PropertyGroup>
    
    <!--  Clean up the old code generated before running build  -->
    <Target Name="CleanObjBeforeBuild" BeforeTargets="Restore">
        <RemoveDir Directories="$(ObjSrcPath)Protobuf" />
        <RemoveDir Directories="$(ObjTestPath)Protobuf" />
    </Target>
    
    <!-- Name of this file must match package ID. -->
    <!-- Packages will be split later. -->
    <Import Project="_contract/_Contract.Tools.targets"/>
    <Import Project="_protobuf/Google.Protobuf.Tools.targets"/>
    <Import Project="_patch/Patch.Tools.targets"/>

    <Target Name="ProtoRecoginziton" BeforeTargets="BeforeBuild">
        <ItemGroup>
            <Protobuf Include="Protobuf/base/*.proto">
                <ContractOutputOptions>nocontract</ContractOutputOptions>
            </Protobuf>
            <Protobuf Include="Protobuf/contract/*.proto"/>
            <Protobuf Include="Protobuf/message/*.proto">
                <ContractOutputOptions>nocontract</ContractOutputOptions>
            </Protobuf>
            <Protobuf Include="Protobuf/reference/*.proto">
                <ContractOutputOptions>reference</ContractOutputOptions>
                <Access>Internal</Access>
            </Protobuf>
            <Protobuf Include="Protobuf/stub/*.proto">
                <ContractOutputOptions>stub</ContractOutputOptions>
                <Access>Internal</Access>
            </Protobuf>
        </ItemGroup>
    </Target>

</Project>
