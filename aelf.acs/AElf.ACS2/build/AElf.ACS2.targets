<?xml version="1.0"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
    </PropertyGroup>
    <PropertyGroup>
        <_Tools_MsBuildAssembly2 Condition=" '$(_Tools_MsBuildAssembly2)' == '' and '$(MSBuildRuntimeType)' == 'Core'  ">..\lib\netstandard1.3\AElf.ACS2.dll</_Tools_MsBuildAssembly2>
        <_Tools_MsBuildAssembly2 Condition=" '$(_Tools_MsBuildAssembly2)' == '' and '$(MSBuildRuntimeType)' != 'Core'  ">..\lib\net46\AElf.ACS2.dll</_Tools_MsBuildAssembly2>
        <_ProtoFilePath2>../Protobuf/acs2.proto</_ProtoFilePath2>
    </PropertyGroup>

    <UsingTask AssemblyFile="$(_Tools_MsBuildAssembly2)" TaskName="AElf.ACS2.FindProtoPath2" />
    <Target Name="reg2" BeforeTargets="CoreCompile;restore">
        <Exec Command="echo 2-----" />
        <ItemGroup>
            <ProtoFile2 Include="$(MSBuildThisFileDirectory)$(_ProtoFilePath2)" />
            <ProtoRef2 Include="@(PackageReference)" Condition=" '%(PackageReference.Identity)' == 'AElf.ACS2' " />
        </ItemGroup>
        <FindProtoPath2 Condition=" '@(ProtoRef2)' != '' " ProtoRef2="@(ProtoRef2)" ReferencePath="@(ReferencePath)">
            <!--            <Output TaskParameter="ProtoTar" ItemName="_ProtoTargetDirs" />-->
            <Output TaskParameter="ProtoTar2" PropertyName="_ProtoTargetDirs2" />
        </FindProtoPath2>
        <Copy SourceFiles="@(ProtoFile2)" DestinationFolder="$(ProjectDir)Protobuf/$(_ProtoTargetDirs2)" ContinueOnError="false" Condition=" @(ProtoFile2) != '' AND $(_ProtoTargetDirs2) != ''" />
    </Target>

</Project>
